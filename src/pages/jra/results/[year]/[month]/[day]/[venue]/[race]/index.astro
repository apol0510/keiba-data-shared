---
/**
 * SEOå‘ã‘çµæœãƒšãƒ¼ã‚¸
 * URL: /jra/results/YYYY/MM/DD/{venueSlug}/{raceNumber}/
 */

/**
 * GitHubã‹ã‚‰JSONãƒ•ã‚¡ã‚¤ãƒ«ãƒªã‚¹ãƒˆã‚’å–å¾—ã—ã¦ãƒ‘ã‚¹ã‚’ç”Ÿæˆ
 * ãƒ“ãƒ«ãƒ‰æ™‚ã«æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦é™çš„HTMLç”Ÿæˆ
 */
export async function getStaticPaths() {
  const paths = [];

  const venueSlugMap = {
    'æ±äº¬': 'tokyo',
    'ä¸­å±±': 'nakayama',
    'äº¬éƒ½': 'kyoto',
    'é˜ªç¥': 'hanshin',
    'ä¸­äº¬': 'chukyo',
    'æ–°æ½Ÿ': 'niigata',
    'ç¦å³¶': 'fukushima',
    'å°å€‰': 'kokura',
    'æœ­å¹Œ': 'sapporo',
    'å‡½é¤¨': 'hakodate'
  };

  try {
    // GitHub APIã§jra/results/é…ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ„ãƒªãƒ¼ã‚’å–å¾—
    const GITHUB_API_URL = 'https://api.github.com/repos/apol0510/keiba-data-shared/git/trees/main?recursive=1';

    const response = await fetch(GITHUB_API_URL, {
      headers: {
        'Accept': 'application/vnd.github.v3+json',
        'User-Agent': 'keiba-data-shared-build'
      }
    });

    if (!response.ok) {
      console.error('GitHub API error:', response.status);
      return paths; // ç©ºé…åˆ—ã‚’è¿”ã—ã¦å¤±æ•—ã‚’é˜²ã
    }

    const data = await response.json();

    // jra/results/YYYY/MM/YYYY-MM-DD.json ã¾ãŸã¯ YYYY-MM-DD-VENUE.json ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŠ½å‡º
    const jsonFiles = data.tree.filter(item =>
      item.path.startsWith('jra/results/') &&
      item.path.endsWith('.json') &&
      item.path.match(/jra\/results\/\d{4}\/\d{2}\/\d{4}-\d{2}-\d{2}(-[A-Z]{2,3})?\.json/)
    );

    console.log(`Found ${jsonFiles.length} JSON files`);

    // å„JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—ã—ã¦ãƒ‘ã‚¹ã‚’ç”Ÿæˆ
    for (const file of jsonFiles) {
      const match = file.path.match(/jra\/results\/(\d{4})\/(\d{2})\/\d{4}-\d{2}-(\d{2})\.json/);
      if (match) {
        const [, year, month, day] = match;

        try {
          // raw URLã‹ã‚‰JSONå–å¾—
          const jsonUrl = `https://raw.githubusercontent.com/apol0510/keiba-data-shared/main/${file.path}`;
          const jsonResponse = await fetch(jsonUrl);

          if (!jsonResponse.ok) continue;

          const jsonData = await jsonResponse.json();

          // çµæœãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚’å¯¾è±¡ã¨ã™ã‚‹ï¼ˆvenue, date, racesãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå¿…é ˆï¼‰
          if (!jsonData.venue || !jsonData.date || !Array.isArray(jsonData.races)) {
            continue;
          }

          const venueSlug = venueSlugMap[jsonData.venue] || 'tokyo';

          // å„ãƒ¬ãƒ¼ã‚¹ã”ã¨ã«ãƒ‘ã‚¹ã‚’ç”Ÿæˆ
          for (const race of jsonData.races) {
            paths.push({
              params: {
                year,
                month,
                day,
                venue: venueSlug,
                race: race.raceNumber.toString()
              }
            });
          }

          console.log(`Generated paths for ${year}-${month}-${day} ${jsonData.venue}: ${jsonData.races.length} races`);
        } catch (e) {
          console.error(`Error processing ${file.path}:`, e.message);
        }
      }
    }

    console.log(`Total paths generated: ${paths.length}`);
  } catch (error) {
    console.error('Fatal error in getStaticPaths:', error);
  }

  return paths;
}

const { year, month, day, venue, race } = Astro.params;

// venueSlugã‹ã‚‰venueåã¸ã®å¤‰æ›ï¼ˆJRA + å—é–¢ï¼‰
const venueMap = {
  'tokyo': 'æ±äº¬',
  'nakayama': 'ä¸­å±±',
  'kyoto': 'äº¬éƒ½',
  'hanshin': 'é˜ªç¥',
  'chukyo': 'ä¸­äº¬',
  'niigata': 'æ–°æ½Ÿ',
  'fukushima': 'ç¦å³¶',
  'kokura': 'å°å€‰',
  'sapporo': 'æœ­å¹Œ',
  'hakodate': 'å‡½é¤¨',
  'ooi': 'å¤§äº•',
  'funabashi': 'èˆ¹æ©‹',
  'kawasaki': 'å·å´',
  'urawa': 'æµ¦å’Œ'
};

// venueåã‹ã‚‰venueCodeã¸ã®å¤‰æ›
const venueCodeMap = {
  'æ±äº¬': 'TOK',
  'ä¸­å±±': 'NAK',
  'äº¬éƒ½': 'KYO',
  'é˜ªç¥': 'HAN',
  'ä¸­äº¬': 'CHU',
  'æ–°æ½Ÿ': 'NII',
  'ç¦å³¶': 'FUK',
  'å°å€‰': 'KOK',
  'æœ­å¹Œ': 'SAP',
  'å‡½é¤¨': 'HAK',
  'å¤§äº•': 'OOI',
  'èˆ¹æ©‹': 'FUN',
  'å·å´': 'KAW',
  'æµ¦å’Œ': 'URA'
};

const venueName = venueMap[venue] || venue;
const venueCode = venueCodeMap[venueName];
const raceNumber = parseInt(race, 10);

// JSONãƒ‡ãƒ¼ã‚¿ã®å–å¾—ï¼ˆä¼šå ´åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«å¯¾å¿œï¼‰
const timestamp = Date.now();
const baseFileName = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
const jsonUrl = venueCode
  ? `https://raw.githubusercontent.com/apol0510/keiba-data-shared/main/jra/results/${year}/${month.padStart(2, '0')}/${baseFileName}-${venueCode}.json?t=${timestamp}`
  : `https://raw.githubusercontent.com/apol0510/keiba-data-shared/main/jra/results/${year}/${month.padStart(2, '0')}/${baseFileName}.json?t=${timestamp}`;

let raceData = null;
let allRaces = [];
let errorMessage = null;

try {
  const response = await fetch(jsonUrl, {
    cache: 'no-store',
    headers: {
      'Cache-Control': 'no-cache, no-store, must-revalidate',
      'Pragma': 'no-cache'
    }
  });

  if (response.ok) {
    const json = await response.json();
    allRaces = json.races || [];
    raceData = allRaces.find(r => r.raceNumber === raceNumber);
  } else {
    errorMessage = 'ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“';
  }
} catch (error) {
  console.error('ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
  errorMessage = 'ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ';
}

// 404ãƒã‚§ãƒƒã‚¯
if (!raceData) {
  return Astro.redirect('/404');
}

// canonical URL
const canonicalUrl = `${Astro.site}jra/results/${year}/${month}/${day}/${venue}/${race}/`;

// ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ
const breadcrumbs = [
  { name: 'ãƒˆãƒƒãƒ—', url: '/' },
  { name: 'JRA', url: '/nankan/' },
  { name: 'çµæœ', url: '/jra/results/' },
  { name: `${year}å¹´`, url: `/jra/results/${year}/` },
  { name: `${year}å¹´${month}æœˆ`, url: `/jra/results/${year}/${month}/` },
  { name: `${year}å¹´${month}æœˆ${day}æ—¥`, url: `/jra/results/${year}/${month}/${day}/` },
  { name: `${venueName}ç«¶é¦¬`, url: `/jra/results/${year}/${month}/${day}/${venue}/` },
  { name: `ç¬¬${raceNumber}R` }
];

// titleç”Ÿæˆ
const distanceText = raceData.distance ? `${raceData.distance}m` : '';
const horsesText = raceData.horses ? `${raceData.horses}é ­ç«‹ã¦` : '';
const raceInfo = [raceData.surface, distanceText, horsesText].filter(Boolean).join(' ');
const title = `${year}å¹´${month}æœˆ${day}æ—¥ ${venueName}ç«¶é¦¬ ç¬¬${raceNumber}R ${raceData.raceName} çµæœ${raceInfo ? ' | ' + raceInfo : ''}`;

// meta descriptionç”Ÿæˆ
const winner = raceData.results[0];
const metaDescription = `${year}å¹´${month}æœˆ${day}æ—¥ ${venueName}ç«¶é¦¬ ç¬¬${raceNumber}R ${raceData.raceName}ã®çµæœã€‚1ç€${winner.name}ï¼ˆ${winner.jockey}ï¼‰${winner.time}ã€‚${raceInfo}ã€ç€é †ãƒ»æ‰•æˆ»é‡‘ã‚’æ²è¼‰ã€‚`;

// å¤©å€™çµµæ–‡å­—ã‚’è¿”ã™é–¢æ•°
const getWeatherEmoji = (weather) => {
  const weatherEmojis = {
    'æ™´': 'â˜€ï¸',
    'æ›‡': 'â˜ï¸',
    'é›¨': 'â˜”',
    'é›ª': 'â„ï¸',
    'å°é›¨': 'ğŸŒ§ï¸',
    'å°é›ª': 'ğŸŒ¨ï¸'
  };
  return weatherEmojis[weather] || '';
};

// ãƒ¬ãƒ¼ã‚¹å†…å®¹è¦ç´„ç”Ÿæˆï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰
const generateRaceSummary = () => {
  if (!raceData.results || raceData.results.length === 0) {
    return 'çµæœãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚';
  }

  const w = raceData.results[0];
  const second = raceData.results[1];
  const third = raceData.results[2];

  // äººæ°—ã«ã‚ˆã‚‹è¡¨ç¾
  const popularityText = w.popularity === 1 ? '1ç•ªäººæ°—ã«å¿œãˆãŸ' : `${w.popularity}ç•ªäººæ°—ã‹ã‚‰`;

  let summary = `${popularityText}${w.number}ç•ª${w.name}ï¼ˆ${w.jockey}é¨æ‰‹ã€${w.trainer}å©èˆï¼‰ãŒ`;

  // ãƒ¬ãƒ¼ã‚¹å±•é–‹ã®èª¬æ˜
  if (w.popularity === 1) {
    summary += 'åŠ›ã‚’ç™ºæ®ã€‚';
  } else if (w.popularity <= 3) {
    summary += 'å¥½èµ°ã‚’è¦‹ã›ã€';
  } else {
    summary += 'äººæ°—ã‚’è£åˆ‡ã‚‹èµ°ã‚Šã§ã€';
  }

  // 2ç€é¦¬ã¨ã®é–¢ä¿‚
  if (second) {
    const marginText = w.margin && w.margin !== '-' ? `${w.margin}å·®` : '';
    if (marginText) {
      summary += `${second.number}ç•ª${second.name}ã‚’${marginText}ã§æŒ¯ã‚Šåˆ‡ã£ã¦`;
    } else {
      summary += `${second.number}ç•ª${second.name}ã‚’ã‹ã‚ã—ã¦`;
    }
  }

  summary += `1ç€ã§ã‚´ãƒ¼ãƒ«ã€‚`;

  // ã‚¿ã‚¤ãƒ æƒ…å ±
  if (w.time) {
    summary += `å‹ã¡ã‚¿ã‚¤ãƒ ${w.time}ã€‚`;
  }

  // ä¸ŠãŒã‚Š3F
  if (w.lastFurlong) {
    summary += `ä¸ŠãŒã‚Š3F${w.lastFurlong}ç§’ã®è„šã‚’ä½¿ã£ãŸã€‚`;
  }

  // é‡è³ã®å ´åˆã®ç‰¹åˆ¥ãªè¡¨ç¾
  if (raceData.raceName && (raceData.raceName.includes('è³') && raceData.raceName.length > 3)) {
    summary += `\n\n${raceData.raceName}ã‚’åˆ¶ã—ãŸ${w.name}ã¯ã€`;
    if (w.popularity === 1) {
      summary += 'é †å½“ã«å®ŸåŠ›ã‚’è¦‹ã›ã¤ã‘ãŸã€‚';
    } else {
      summary += 'ç´ æ™´ã‚‰ã—ã„èµ°ã‚Šã‚’æŠ«éœ²ã—ãŸã€‚';
    }
  }

  // 2ç€ãƒ»3ç€ã®æƒ…å ±
  if (second && third) {
    summary += `\n\n2ç€ã«ã¯${second.popularity}ç•ªäººæ°—ã®${second.name}ãŒå…¥ã‚Šã€3ç€ã¯${third.popularity}ç•ªäººæ°—ã®${third.name}ã€‚`;

    // ä¸Šä½3é ­ã®äººæ°—å‚¾å‘
    const topThreePopularity = [w.popularity, second.popularity, third.popularity].sort((a, b) => a - b);
    if (topThreePopularity[0] === 1 && topThreePopularity[1] === 2 && topThreePopularity[2] === 3) {
      summary += 'äººæ°—é †ã®æ±ºç€ã¨ãªã£ãŸã€‚';
    } else if (topThreePopularity[2] >= 5) {
      summary += 'æ³¢ä¹±ã®æ±ºç€ã¨ãªã£ãŸã€‚';
    } else {
      summary += 'å®ŸåŠ›é€šã‚Šã®ä¸Šä½äº‰ã„ã¨ãªã£ãŸã€‚';
    }
  }

  return summary;
};

---

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>{title}</title>
  <meta name="description" content={metaDescription}>

  <!-- canonical URL -->
  <link rel="canonical" href={canonicalUrl}>

  <!-- JSONæ­£æœ¬ã¸ã®ãƒªãƒ³ã‚¯ -->
  <link rel="alternate" type="application/json" href={jsonUrl}>

  <!-- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿: BreadcrumbList -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": breadcrumbs.map((item, index) => ({
      "@type": "ListItem",
      "position": index + 1,
      "name": item.name,
      "item": item.url ? `${Astro.site}${item.url.slice(1)}` : undefined
    }))
  })} />

  <!-- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿: SportsEventï¼ˆç°¡ç´ ç‰ˆï¼‰ -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "SportsEvent",
    "name": raceData.raceName,
    "sport": "ç«¶é¦¬",
    "startDate": `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}T${raceData.startTime || '00:00'}:00+09:00`,
    "location": {
      "@type": "Place",
      "name": `${venueName}ç«¶é¦¬å ´`
    }
  })} />

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
      line-height: 1.6;
      color: #2C3E50;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      background-attachment: fixed;
      min-height: 100vh;
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ - ãƒãƒƒãƒ—ãªãƒ‡ã‚¶ã‚¤ãƒ³ */
    .page-header {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 50%, #f093fb 100%);
      color: white;
      padding: 2rem 1rem;
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
      position: relative;
      overflow: hidden;
    }

    .page-header::before {
      content: 'ğŸ‡';
      position: absolute;
      font-size: 12rem;
      opacity: 0.1;
      right: -2rem;
      top: -2rem;
      transform: rotate(-15deg);
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    /* ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ */
    nav[aria-label="ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ"] {
      margin-bottom: 1rem;
      font-size: 0.875rem;
      opacity: 0.95;
    }

    nav[aria-label="ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ"] ol {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      list-style: none;
    }

    nav[aria-label="ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ"] li::after {
      content: 'â€º';
      margin-left: 0.5rem;
    }

    nav[aria-label="ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ"] li:last-child::after {
      content: '';
    }

    nav[aria-label="ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ"] a {
      color: white;
      text-decoration: none;
      transition: opacity 0.2s;
    }

    nav[aria-label="ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ"] a:hover {
      opacity: 0.8;
      text-decoration: underline;
    }

    nav[aria-label="ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ"] span {
      color: white;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 0.75rem;
      font-weight: 800;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    h1::before {
      content: 'ğŸ†';
      font-size: 1.75rem;
    }

    .race-meta {
      margin-top: 0.75rem;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      font-size: 1rem;
      opacity: 0.95;
      font-weight: 500;
    }

    .race-meta span {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    main {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem 2rem;
    }

    /* ã‚«ãƒ¼ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    section {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    h2 {
      font-size: 1.5rem;
      margin: 0 0 1.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    /* å®šç¾©ãƒªã‚¹ãƒˆ */
    dl {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 1rem 2rem;
      margin-bottom: 1rem;
    }

    dt {
      font-weight: 700;
      color: #f093fb;
      font-size: 0.95rem;
    }

    dd {
      color: #2C3E50;
      font-weight: 600;
    }

    /* å‹ã¡é¦¬ãƒã‚¤ãƒ©ã‚¤ãƒˆ - ãƒãƒƒãƒ—ãªãƒ‡ã‚¶ã‚¤ãƒ³ */
    .winner-highlight {
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      border-radius: 16px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 8px 24px rgba(255, 215, 0, 0.4);
      position: relative;
      overflow: hidden;
    }

    .winner-highlight::before {
      content: 'ğŸ‘‘';
      position: absolute;
      font-size: 6rem;
      opacity: 0.2;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
    }

    .winner-highlight strong {
      display: inline-block;
      background: rgba(255, 255, 255, 0.9);
      color: #FF6B00;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      font-size: 0.95rem;
      margin-bottom: 1rem;
      font-weight: 800;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .winner-highlight p {
      margin: 0.75rem 0;
      font-size: 1.25rem;
      color: white;
      font-weight: 700;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
      position: relative;
      z-index: 1;
    }

    /* ãƒ†ãƒ¼ãƒ–ãƒ« - ã‚«ãƒ©ãƒ•ãƒ«ãªãƒ‡ã‚¶ã‚¤ãƒ³ */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      font-size: 0.875rem;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    caption {
      text-align: left;
      font-weight: 700;
      margin-bottom: 1rem;
      font-size: 1.1rem;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    th, td {
      padding: 1rem 0.75rem;
      text-align: left;
    }

    th {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      font-weight: 700;
      white-space: nowrap;
      font-size: 0.875rem;
    }

    td:nth-child(1),
    td:nth-child(2),
    td:nth-child(3),
    td:nth-child(7),
    td:nth-child(8),
    td:nth-child(9),
    td:nth-child(10) {
      text-align: center;
    }

    tbody tr {
      border-bottom: 1px solid rgba(0,0,0,0.05);
      transition: all 0.3s ease;
      background: white;
    }

    /* 4ç€ä»¥é™ - ç™½èƒŒæ™¯ */
    tbody tr:nth-child(n+4) {
      background: white;
    }

    tbody tr:nth-child(n+4):hover {
      background: #FAFAFA;
      transform: translateX(4px);
    }

    /* 1ç€ - é‡‘è‰² */
    tbody tr:first-child {
      background: linear-gradient(135deg, #FFF9C4 0%, #FFEB3B 100%);
      font-weight: 700;
    }

    tbody tr:first-child:hover {
      background: linear-gradient(135deg, #FFF176 0%, #FFEB3B 100%);
    }

    /* 2ç€ - éŠ€è‰² */
    tbody tr:nth-child(2) {
      background: linear-gradient(135deg, #F5F5F5 0%, #E0E0E0 100%);
      font-weight: 700;
    }

    tbody tr:nth-child(2):hover {
      background: linear-gradient(135deg, #EEEEEE 0%, #D5D5D5 100%);
    }

    /* 3ç€ - éŠ…è‰² */
    tbody tr:nth-child(3) {
      background: linear-gradient(135deg, #FFE4C4 0%, #E6BE8A 100%);
      font-weight: 700;
    }

    tbody tr:nth-child(3):hover {
      background: linear-gradient(135deg, #FFD7A8 0%, #DEB887 100%);
    }

    /* æ‰•æˆ»é‡‘ - ç›®ç«‹ã¤ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ */
    .payouts-main {
      background: linear-gradient(135deg, #4ECDC4 0%, #44A08D 100%);
      padding: 2rem;
      border-radius: 16px;
      margin-bottom: 2rem;
      box-shadow: 0 8px 24px rgba(78, 205, 196, 0.4);
      position: relative;
      overflow: hidden;
    }

    .payouts-main::before {
      content: 'ğŸ’°';
      position: absolute;
      font-size: 8rem;
      opacity: 0.15;
      right: 1rem;
      bottom: -1rem;
    }

    .payouts-main dl {
      grid-template-columns: 120px 1fr;
      gap: 1.25rem 2rem;
      position: relative;
      z-index: 1;
    }

    .payouts-main dt {
      font-weight: 800;
      color: white;
      font-size: 1.1rem;
    }

    .payouts-main dd {
      font-size: 1.25rem;
      color: white;
      font-weight: 700;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    }

    /* æŠ˜ã‚ŠãŸãŸã¿ */
    details {
      margin: 1.5rem 0;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      padding: 1rem 1.5rem;
      transition: all 0.3s ease;
    }

    details:hover {
      border-color: #f093fb;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
    }

    summary {
      cursor: pointer;
      font-weight: 700;
      padding: 0.5rem 0;
      user-select: none;
      color: #f093fb;
      font-size: 1.05rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    summary::before {
      content: 'â–¶';
      font-size: 0.75rem;
      transition: transform 0.3s ease;
    }

    details[open] summary::before {
      transform: rotate(90deg);
    }

    details[open] summary {
      margin-bottom: 1.5rem;
    }

    .note {
      font-size: 0.875rem;
      color: #7f8c8d;
      margin-top: 1rem;
      font-style: italic;
    }

    /* ãƒ¬ãƒ¼ã‚¹å†…å®¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ - ç‰¹åˆ¥å¼·èª¿ãƒ‡ã‚¶ã‚¤ãƒ³ */
    .race-commentary-section {
      background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 50%, #FFA500 100%);
      border-radius: 24px;
      padding: 2.5rem;
      margin: 3rem 0;
      box-shadow: 0 12px 48px rgba(255, 107, 107, 0.35);
      border: 3px solid rgba(255, 255, 255, 0.3);
      position: relative;
      overflow: hidden;
      animation: pulse-glow 3s ease-in-out infinite;
    }

    @keyframes pulse-glow {
      0%, 100% {
        box-shadow: 0 12px 48px rgba(255, 107, 107, 0.35);
      }
      50% {
        box-shadow: 0 12px 60px rgba(255, 107, 107, 0.5), 0 0 30px rgba(255, 107, 107, 0.3);
      }
    }

    .race-commentary-section::before {
      content: 'ğŸ†';
      position: absolute;
      font-size: 20rem;
      opacity: 0.08;
      right: -3rem;
      top: 50%;
      transform: translateY(-50%) rotate(-15deg);
      pointer-events: none;
    }

    .commentary-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(255, 255, 255, 0.95);
      padding: 0.75rem 1.5rem;
      border-radius: 50px;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
      position: relative;
      z-index: 1;
      animation: badge-bounce 2s ease-in-out infinite;
    }

    @keyframes badge-bounce {
      0%, 100% {
        transform: translateY(0);
      }
      50% {
        transform: translateY(-5px);
      }
    }

    .badge-icon {
      font-size: 1.25rem;
      animation: spin-star 3s linear infinite;
    }

    @keyframes spin-star {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    .badge-text {
      font-size: 0.95rem;
      font-weight: 800;
      background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: 0.5px;
    }

    .commentary-title {
      font-size: 2.5rem;
      color: white;
      margin-bottom: 2rem;
      font-weight: 900;
      text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      gap: 1rem;
      position: relative;
      z-index: 1;
    }

    .title-icon {
      font-size: 2.5rem;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
    }

    .title-text {
      letter-spacing: 2px;
    }

    .commentary-content {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 2.5rem;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      position: relative;
      z-index: 1;
      border: 2px solid rgba(255, 255, 255, 0.5);
    }

    .commentary-content p {
      line-height: 2.2;
      font-size: 1.2rem;
      color: #2C3E50;
      font-weight: 500;
      text-align: justify;
      letter-spacing: 0.5px;
      margin: 0;
    }

    .commentary-content::before {
      content: '"';
      position: absolute;
      font-size: 8rem;
      color: rgba(255, 107, 107, 0.15);
      left: 1rem;
      top: -2rem;
      font-family: Georgia, serif;
      line-height: 1;
    }

    /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
    @media (max-width: 768px) {
      .race-commentary-section {
        padding: 2rem 1.5rem;
        margin: 2rem 0;
        border-radius: 20px;
      }

      .race-commentary-section::before {
        font-size: 10rem;
        right: -2rem;
      }

      .commentary-badge {
        padding: 0.6rem 1.25rem;
        font-size: 0.85rem;
      }

      .badge-text {
        font-size: 0.85rem;
      }

      .commentary-title {
        font-size: 1.75rem;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
      }

      .title-icon {
        font-size: 1.75rem;
      }

      .commentary-content {
        padding: 1.75rem;
        border-radius: 16px;
      }

      .commentary-content p {
        font-size: 1.05rem;
        line-height: 1.9;
      }

      .commentary-content::before {
        font-size: 5rem;
        left: 0.5rem;
        top: -1.5rem;
      }
    }

    /* ãƒ•ãƒƒã‚¿ãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ - ã‚«ãƒ©ãƒ•ãƒ«ãªãƒœã‚¿ãƒ³ */
    .race-footer {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 2rem;
      margin-top: 2rem;
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    .race-footer h3 {
      font-size: 1.25rem;
      margin-bottom: 1.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .race-footer ul {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      list-style: none;
    }

    .race-footer li {
      flex: 0 0 auto;
    }

    .race-footer a,
    .race-footer strong {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 1.5rem;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 12px;
      color: #2C3E50;
      text-decoration: none;
      transition: all 0.3s ease;
      font-weight: 700;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
      min-width: 80px;
    }

    .race-footer a:hover {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .race-footer strong {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    /* ã‚µã‚¤ãƒˆãƒ•ãƒƒã‚¿ãƒ¼ - ãƒãƒƒãƒ—ãªãƒ‡ã‚¶ã‚¤ãƒ³ */
    .site-footer {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 50%, #f093fb 100%);
      color: white;
      text-align: center;
      padding: 3rem 1rem;
      margin-top: 3rem;
      box-shadow: 0 -8px 32px rgba(102, 126, 234, 0.3);
      position: relative;
      overflow: hidden;
    }

    .site-footer::before {
      content: 'ğŸ‡';
      position: absolute;
      font-size: 10rem;
      opacity: 0.1;
      left: -2rem;
      top: 50%;
      transform: translateY(-50%) rotate(15deg);
      animation: float-horse 6s ease-in-out infinite;
    }

    @keyframes float-horse {
      0%, 100% {
        transform: translateY(-50%) rotate(15deg) translateX(0);
      }
      50% {
        transform: translateY(-50%) rotate(15deg) translateX(20px);
      }
    }

    .site-footer::after {
      content: 'ğŸ†';
      position: absolute;
      font-size: 8rem;
      opacity: 0.1;
      right: -1rem;
      top: 50%;
      transform: translateY(-50%) rotate(-15deg);
      animation: float-trophy 5s ease-in-out infinite;
    }

    @keyframes float-trophy {
      0%, 100% {
        transform: translateY(-50%) rotate(-15deg) translateX(0);
      }
      50% {
        transform: translateY(-50%) rotate(-15deg) translateX(-20px);
      }
    }

    .site-footer p {
      font-size: 1rem;
      opacity: 0.95;
      margin: 0.75rem 0;
      font-weight: 600;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
      position: relative;
      z-index: 1;
    }

    .site-footer p:first-child {
      font-size: 1.25rem;
      font-weight: 800;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .site-footer a {
      color: white;
      text-decoration: none;
      font-weight: 600;
      transition: opacity 0.2s;
    }

    .site-footer a:hover {
      opacity: 0.8;
      text-decoration: underline;
    }

    /* ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ */
    @media (max-width: 768px) {
      .page-header {
        padding: 1.5rem 1rem;
      }

      h1 {
        font-size: 1.5rem;
      }

      main {
        padding: 0 0.5rem 1.5rem;
      }

      section {
        padding: 1.5rem;
        border-radius: 16px;
        margin-bottom: 1.5rem;
      }

      h2 {
        font-size: 1.25rem;
      }

      table {
        display: block;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        font-size: 0.75rem;
      }

      th, td {
        padding: 0.75rem 0.5rem;
      }

      dl {
        grid-template-columns: 1fr;
        gap: 0.75rem;
      }

      .payouts-main dl {
        grid-template-columns: 1fr;
      }

      .winner-highlight {
        padding: 1.5rem;
      }

      .winner-highlight p {
        font-size: 1.05rem;
      }

      .race-footer ul {
        gap: 0.5rem;
      }

      .race-footer a,
      .race-footer strong {
        padding: 0.6rem 1rem;
        font-size: 0.875rem;
        min-width: 70px;
      }
    }
  </style>
</head>

<body>
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="page-header">
    <div class="header-content">
      <!-- ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ -->
      <nav aria-label="ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ">
        <ol>
          {breadcrumbs.map((item, index) => (
            <li>
              {item.url ? (
                <a href={item.url}>{item.name}</a>
              ) : (
                <span>{item.name}</span>
              )}
            </li>
          ))}
        </ol>
      </nav>

      <h1>{raceData.raceName}</h1>
      <div class="race-meta">
        <time datetime={`${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`}>
          ğŸ“… {year}å¹´{month}æœˆ{day}æ—¥
        </time>
        <span>ğŸ‡ {venueName}ç«¶é¦¬å ´</span>
        <span>ğŸ ç¬¬{raceNumber}R</span>
        {raceData.startTime && <span>â° {raceData.startTime}ç™ºèµ°</span>}
        {raceData.weather && <span>å¤©å€™ {raceData.weather}{getWeatherEmoji(raceData.weather)}</span>}
        {raceData.trackCondition && <span>é¦¬å ´ {raceData.trackCondition}</span>}
      </div>
    </div>
  </header>

  <main>
    <article>

      <!-- 1. ãƒ¬ãƒ¼ã‚¹æ¦‚è¦ -->
      <section>
        <h2>ğŸ“‹ ãƒ¬ãƒ¼ã‚¹æ¦‚è¦</h2>
        <dl>
          <dt>ãƒ¬ãƒ¼ã‚¹å</dt>
          <dd>{raceData.raceName}</dd>

          <dt>è·é›¢ãƒ»ã‚³ãƒ¼ã‚¹</dt>
          <dd>{raceData.surface}{raceData.distance ? `${raceData.distance}m` : ''}{raceData.track ? `ï¼ˆ${raceData.track}ï¼‰` : ''}</dd>

          {raceData.horses && (
            <>
              <dt>å‡ºèµ°é ­æ•°</dt>
              <dd>{raceData.horses}é ­</dd>
            </>
          )}

          {raceData.weather && (
            <>
              <dt>å¤©å€™</dt>
              <dd>{raceData.weather} {getWeatherEmoji(raceData.weather)}</dd>
            </>
          )}

          {raceData.trackCondition && (
            <>
              <dt>é¦¬å ´çŠ¶æ…‹</dt>
              <dd>{raceData.trackCondition}</dd>
            </>
          )}
        </dl>
      </section>

      <!-- 2. ç€é †çµæœ -->
      <section>
        <h2>ğŸ† ç€é †çµæœ</h2>

        <div class="winner-highlight">
          <strong>ğŸ¥‡ 1ç€</strong>
          <p>{winner.number}ç•ª {winner.name}ï¼ˆ{winner.jockey}ï¼‰</p>
          <p>ã‚¿ã‚¤ãƒ : {winner.time} / äººæ°—: {winner.popularity}ç•ªäººæ°—</p>
        </div>

        <table>
          <caption>ç¬¬{raceNumber}R ç€é †è¡¨</caption>
          <thead>
            <tr>
              <th>ç€é †</th>
              <th>æ </th>
              <th>é¦¬ç•ª</th>
              <th>é¦¬å</th>
              <th>é¨æ‰‹</th>
              <th>èª¿æ•™å¸«</th>
              <th>ã‚¿ã‚¤ãƒ </th>
              <th>ç€å·®</th>
              <th>ä¸Š3F</th>
              <th>äººæ°—</th>
            </tr>
          </thead>
          <tbody>
            {raceData.results.map(horse => (
              <tr>
                <td>{horse.rank}</td>
                <td>{horse.bracket}</td>
                <td>{horse.number}</td>
                <td><strong>{horse.name}</strong></td>
                <td>{horse.jockey}</td>
                <td>{horse.trainer}</td>
                <td>{horse.time}</td>
                <td>{horse.margin}</td>
                <td>{horse.lastFurlong}</td>
                <td>{horse.popularity}</td>
              </tr>
            ))}
          </tbody>
        </table>
      </section>

      <!-- 3. æ‰•æˆ»é‡‘ -->
      <section>
        <h2>ğŸ’° æ‰•æˆ»é‡‘</h2>

        {raceData.payouts && (
          <div class="payouts-main">
            <dl>
              {raceData.payouts.tansho && raceData.payouts.tansho[0] && (
                <>
                  <dt>å˜å‹</dt>
                  <dd>{raceData.payouts.tansho[0].number}ç•ª {raceData.payouts.tansho[0].payout.toLocaleString()}å††ï¼ˆ{raceData.payouts.tansho[0].popularity}ç•ªäººæ°—ï¼‰</dd>
                </>
              )}

              {raceData.payouts.umatan && raceData.payouts.umatan[0] && (
                <>
                  <dt>é¦¬å˜</dt>
                  <dd>{raceData.payouts.umatan[0].combination} {raceData.payouts.umatan[0].payout.toLocaleString()}å††ï¼ˆ{raceData.payouts.umatan[0].popularity}ç•ªäººæ°—ï¼‰</dd>
                </>
              )}

              {raceData.payouts.sanrentan && raceData.payouts.sanrentan[0] && (
                <>
                  <dt>ä¸‰é€£å˜</dt>
                  <dd>{raceData.payouts.sanrentan[0].combination} {raceData.payouts.sanrentan[0].payout.toLocaleString()}å††ï¼ˆ{raceData.payouts.sanrentan[0].popularity}ç•ªäººæ°—ï¼‰</dd>
                </>
              )}
            </dl>
          </div>
        )}

        <details>
          <summary>å…¨åˆ¸ç¨®ã®æ‰•æˆ»é‡‘ã‚’è¦‹ã‚‹</summary>
          <table>
            <thead>
              <tr>
                <th>åˆ¸ç¨®</th>
                <th>çµ„ç•ª</th>
                <th>æ‰•æˆ»é‡‘</th>
                <th>äººæ°—</th>
              </tr>
            </thead>
            <tbody>
              {raceData.payouts?.fukusho?.map(item => (
                <tr>
                  <td>è¤‡å‹</td>
                  <td>{item.number}ç•ª</td>
                  <td>{item.payout.toLocaleString()}å††</td>
                  <td>{item.popularity}</td>
                </tr>
              ))}

              {raceData.payouts?.wakuren?.map(item => (
                <tr>
                  <td>æ é€£</td>
                  <td>{item.combination}</td>
                  <td>{item.payout.toLocaleString()}å††</td>
                  <td>{item.popularity}</td>
                </tr>
              ))}

              {raceData.payouts?.umaren?.map(item => (
                <tr>
                  <td>é¦¬é€£</td>
                  <td>{item.combination}</td>
                  <td>{item.payout.toLocaleString()}å††</td>
                  <td>{item.popularity}</td>
                </tr>
              ))}

              {raceData.payouts?.wakutan?.map(item => (
                <tr>
                  <td>æ å˜</td>
                  <td>{item.combination}</td>
                  <td>{item.payout.toLocaleString()}å††</td>
                  <td>{item.popularity}</td>
                </tr>
              ))}

              {raceData.payouts?.wide?.map(item => (
                <tr>
                  <td>ãƒ¯ã‚¤ãƒ‰</td>
                  <td>{item.combination}</td>
                  <td>{item.payout.toLocaleString()}å††</td>
                  <td>{item.popularity}</td>
                </tr>
              ))}

              {raceData.payouts?.sanrenpuku?.map(item => (
                <tr>
                  <td>ä¸‰é€£è¤‡</td>
                  <td>{item.combination}</td>
                  <td>{item.payout.toLocaleString()}å††</td>
                  <td>{item.popularity}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </details>
      </section>

      <!-- 4. ãƒ¬ãƒ¼ã‚¹å†…å®¹å›é¡§ - ç‰¹åˆ¥å¼·èª¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <section class="race-commentary-section">
        <div class="commentary-badge">
          <span class="badge-icon">âœ¨</span>
          <span class="badge-text">ãƒ¬ãƒ¼ã‚¹å±•é–‹è§£èª¬</span>
        </div>
        <h2 class="commentary-title">
          <span class="title-icon">ğŸ“</span>
          <span class="title-text">ãƒ¬ãƒ¼ã‚¹å†…å®¹å›é¡§</span>
        </h2>
        <div class="commentary-content">
          <p>{raceData.comment || generateRaceSummary()}</p>
        </div>
      </section>

      <!-- 5. è©³ç´°ãƒ‡ãƒ¼ã‚¿ -->
      <section>
        <h2>ğŸ“Š è©³ç´°ãƒ‡ãƒ¼ã‚¿</h2>

        {raceData.timeData && (
          <details>
            <summary>â±ï¸ ãƒ©ãƒƒãƒ—ã‚¿ã‚¤ãƒ </summary>
            <dl>
              {raceData.timeData.last3F && (
                <>
                  <dt>ä¸ŠãŒã‚Š3F</dt>
                  <dd>{raceData.timeData.last3F}ç§’</dd>
                </>
              )}

              {raceData.timeData.last4F && (
                <>
                  <dt>ä¸ŠãŒã‚Š4F</dt>
                  <dd>{raceData.timeData.last4F}ç§’</dd>
                </>
              )}

              {raceData.timeData.furlongTimes && raceData.timeData.furlongTimes.length > 0 && (
                <>
                  <dt>ãƒãƒ­ãƒ³ã‚¿ã‚¤ãƒ ï¼ˆ200mæ¯ï¼‰</dt>
                  <dd>{raceData.timeData.furlongTimes.join(' - ')}</dd>
                </>
              )}
            </dl>
          </details>
        )}

        {raceData.cornerData && raceData.cornerData.length > 0 && (
          <details>
            <summary>ğŸ“ ã‚³ãƒ¼ãƒŠãƒ¼é€šéé †</summary>
            <dl>
              {raceData.cornerData.map(corner => (
                <>
                  <dt>{corner.corner}</dt>
                  <dd>{corner.order.join(',')}</dd>
                </>
              ))}
            </dl>
            <p class="note">â€» æ•°å­—ã¯é¦¬ç•ªã‚’ç¤ºã—ã¾ã™</p>
          </details>
        )}
      </section>

      <!-- ãƒ•ãƒƒã‚¿ãƒ¼: é–¢é€£ãƒ¬ãƒ¼ã‚¹ -->
      <div class="race-footer">
        <nav aria-label="é–¢é€£ãƒ¬ãƒ¼ã‚¹">
          <h3>ğŸ åŒæ—¥ã®ä»–ãƒ¬ãƒ¼ã‚¹</h3>
          <ul>
            {allRaces.map(r => (
              <li>
                {r.raceNumber === raceNumber ? (
                  <strong>ç¬¬{r.raceNumber}R</strong>
                ) : (
                  <a href={`/jra/results/${year}/${month}/${day}/${venue}/${r.raceNumber}/`}>
                    ç¬¬{r.raceNumber}R
                  </a>
                )}
              </li>
            ))}
          </ul>
        </nav>
      </div>
    </article>
  </main>

  <!-- ã‚µã‚¤ãƒˆãƒ•ãƒƒã‚¿ãƒ¼ -->
  <footer class="site-footer">
    <p><a href="/">ğŸ‡ JRAçµæœé€Ÿå ±ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</a></p>
    <p>ä¸­å¤®åœ°æ–¹ç«¶é¦¬ã®çµæœæƒ…å ±ã‚’æä¾›</p>
    <p style="margin-top: 1rem; font-size: 0.85rem;">&copy; 2026 All rights reserved</p>
  </footer>
</body>
</html>
