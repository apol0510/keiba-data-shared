---
/**
 * å—é–¢ç«¶é¦¬ çµæœã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼ˆå…¨ä½“ï¼‰
 * URL: /nankan/results/
 */

const title = 'å—é–¢ç«¶é¦¬ çµæœã‚¢ãƒ¼ã‚«ã‚¤ãƒ– | å¤§äº•ãƒ»å·å´ãƒ»èˆ¹æ©‹ãƒ»æµ¦å’Œ';
const description = 'å—é–¢æ±4ç«¶é¦¬å ´ï¼ˆå¤§äº•ãƒ»å·å´ãƒ»èˆ¹æ©‹ãƒ»æµ¦å’Œï¼‰ã®éå»ã®ãƒ¬ãƒ¼ã‚¹çµæœã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã€‚å¹´æœˆåˆ¥ã«æ¤œç´¢ã§ãã¾ã™ã€‚';

import { readdirSync, readFileSync } from 'fs';
import { join } from 'path';

// ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰å…¨çµæœãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
const archiveData = [];

try {
  const resultsDir = join(process.cwd(), 'nankan', 'results');

  // å¹´ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å–å¾—
  const years = readdirSync(resultsDir).filter(name => /^\d{4}$/.test(name));

  for (const year of years) {
    const yearDir = join(resultsDir, year);

    // æœˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å–å¾—
    const months = readdirSync(yearDir).filter(name => /^\d{2}$/.test(name));

    for (const month of months) {
      const monthDir = join(yearDir, month);

      // JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—
      const files = readdirSync(monthDir).filter(name => name.endsWith('.json'));

      for (const file of files) {
        try {
          const filePath = join(monthDir, file);
          const content = readFileSync(filePath, 'utf-8');
          const jsonData = JSON.parse(content);

          // å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿è¿½åŠ 
          if (jsonData.date && jsonData.venue && jsonData.races) {
            archiveData.push({
              date: jsonData.date,
              venue: jsonData.venue,
              venueCode: jsonData.venueCode || '',
              raceCount: jsonData.races.length,
              year,
              month
            });
          }
        } catch (e) {
          console.error(`Error reading ${file}:`, e.message);
        }
      }
    }
  }

  // æ—¥ä»˜ã®æ–°ã—ã„é †ã«ã‚½ãƒ¼ãƒˆ
  archiveData.sort((a, b) => {
    if (!a.date || !b.date) return 0;
    return b.date.localeCompare(a.date);
  });
} catch (error) {
  console.error('ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error);
}

// å¹´æœˆåˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
const groupedByYearMonth = archiveData.reduce((acc, item) => {
  const key = `${item.year}-${item.month}`;
  if (!acc[key]) {
    acc[key] = [];
  }
  acc[key].push(item);
  return acc;
}, {});

const canonicalUrl = `${Astro.site}nankan/results/`;
---

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>{title}</title>
  <meta name="description" content={description}>

  <link rel="canonical" href={canonicalUrl}>

  <!-- OGP -->
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:type" content="website">
  <meta property="og:url" content={canonicalUrl}>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
      line-height: 1.6;
      color: #2C3E50;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      background-attachment: fixed;
      min-height: 100vh;
    }

    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      color: white;
      padding: 2.5rem 1rem;
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
      position: relative;
      overflow: hidden;
    }

    header::before {
      content: 'ğŸ“š';
      position: absolute;
      font-size: 12rem;
      opacity: 0.1;
      right: -1rem;
      top: -2rem;
      transform: rotate(-10deg);
    }

    .header-content {
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    .breadcrumb {
      font-size: 0.95rem;
      margin-bottom: 1.25rem;
      opacity: 0.95;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .breadcrumb::before {
      content: 'ğŸ ';
    }

    .breadcrumb a {
      color: white;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .breadcrumb a:hover {
      text-shadow: 0 0 10px rgba(255,255,255,0.8);
    }

    h1 {
      font-size: 2.25rem;
      margin-bottom: 0.75rem;
      font-weight: 800;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    h1::before {
      content: 'ğŸ“–';
      font-size: 2rem;
    }

    .page-meta {
      font-size: 1.05rem;
      opacity: 0.95;
      font-weight: 600;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .page-meta::before {
      content: 'ğŸ“Š';
    }

    main {
      max-width: 1200px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    .archive-section {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 2rem;
      margin-bottom: 2rem;
      box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }

    .archive-section h2 {
      font-size: 1.75rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 1.5rem;
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding-bottom: 0.75rem;
      border-bottom: 3px solid transparent;
      border-image: linear-gradient(90deg, #667eea, #764ba2, transparent) 1;
    }

    .archive-section h2::before {
      content: 'ğŸ“…';
      font-size: 1.5rem;
    }

    .archive-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

    .archive-card {
      display: block;
      background: white;
      border-radius: 16px;
      padding: 1.5rem;
      text-decoration: none;
      color: inherit;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      border: 3px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .archive-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .archive-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 12px 40px rgba(0,0,0,0.15);
      border-color: #667eea;
    }

    .archive-card:hover::before {
      opacity: 1;
    }

    .archive-date {
      font-size: 1.25rem;
      font-weight: 700;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 0.75rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .archive-date::before {
      content: 'ğŸ“…';
      -webkit-text-fill-color: initial;
      background: none;
    }

    .archive-venue {
      font-size: 1.05rem;
      color: #555;
      margin-bottom: 0.5rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .archive-venue::before {
      content: 'ğŸ‡';
    }

    .archive-races {
      font-size: 0.95rem;
      color: #888;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .archive-races::before {
      content: 'ğŸ';
    }

    .no-data {
      text-align: center;
      padding: 3rem;
      color: #7f8c8d;
      font-size: 1.1rem;
      font-weight: 600;
    }

    .no-data::before {
      content: 'ğŸ“­';
      display: block;
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    footer {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
      color: white;
      text-align: center;
      padding: 3rem 1rem;
      margin-top: 3rem;
      box-shadow: 0 -8px 32px rgba(102, 126, 234, 0.3);
      position: relative;
      overflow: hidden;
    }

    footer::before {
      content: 'ğŸ‡';
      position: absolute;
      font-size: 10rem;
      opacity: 0.1;
      left: -2rem;
      top: 50%;
      transform: translateY(-50%) rotate(15deg);
      animation: float-horse 6s ease-in-out infinite;
    }

    @keyframes float-horse {
      0%, 100% {
        transform: translateY(-50%) rotate(15deg) translateX(0);
      }
      50% {
        transform: translateY(-50%) rotate(15deg) translateX(20px);
      }
    }

    footer::after {
      content: 'ğŸ†';
      position: absolute;
      font-size: 8rem;
      opacity: 0.1;
      right: -1rem;
      top: 50%;
      transform: translateY(-50%) rotate(-15deg);
      animation: float-trophy 5s ease-in-out infinite;
    }

    @keyframes float-trophy {
      0%, 100% {
        transform: translateY(-50%) rotate(-15deg) translateX(0);
      }
      50% {
        transform: translateY(-50%) rotate(-15deg) translateX(-20px);
      }
    }

    footer p {
      font-size: 1rem;
      opacity: 0.95;
      margin: 0.75rem 0;
      font-weight: 600;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
      position: relative;
      z-index: 1;
    }

    footer p:first-child {
      font-size: 1.25rem;
      font-weight: 800;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    @media (max-width: 768px) {
      h1 {
        font-size: 1.75rem;
      }

      header {
        padding: 2rem 1rem;
      }

      .archive-section {
        padding: 1.5rem;
        border-radius: 16px;
      }

      .archive-section h2 {
        font-size: 1.5rem;
      }

      .archive-grid {
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 1rem;
      }

      .archive-card {
        padding: 1.25rem;
      }
    }
  </style>
</head>

<body>
  <header>
    <div class="header-content">
      <div class="breadcrumb">
        <a href="/">ãƒˆãƒƒãƒ—</a> &gt; å—é–¢ç«¶é¦¬çµæœã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
      </div>
      <h1>å—é–¢ç«¶é¦¬ çµæœã‚¢ãƒ¼ã‚«ã‚¤ãƒ–</h1>
      <p class="page-meta">å…¨{archiveData.length}é–‹å‚¬ã®çµæœã‚’æ²è¼‰ä¸­</p>
    </div>
  </header>

  <main>
    {Object.entries(groupedByYearMonth).map(([yearMonth, items]) => {
      const [year, month] = yearMonth.split('-');
      return (
        <section class="archive-section">
          <h2>{year}å¹´{parseInt(month)}æœˆ</h2>
          <div class="archive-grid">
            {items.map(item => {
              if (!item.date) return null;
              const [y, m, d] = item.date.split('-');
              return (
                <a href={`/nankan/results/${y}/${m}/${d}/`} class="archive-card">
                  <div class="archive-date">{y}å¹´{parseInt(m)}æœˆ{parseInt(d)}æ—¥</div>
                  <div class="archive-venue">{item.venue}ç«¶é¦¬</div>
                  <div class="archive-races">å…¨{item.raceCount}ãƒ¬ãƒ¼ã‚¹</div>
                </a>
              );
            })}
          </div>
        </section>
      );
    })}

    {archiveData.length === 0 && (
      <div class="archive-section">
        <p class="no-data">ç¾åœ¨è¡¨ç¤ºã§ãã‚‹çµæœãƒ‡ãƒ¼ã‚¿ã¯ã‚ã‚Šã¾ã›ã‚“</p>
      </div>
    )}
  </main>

  <footer>
    <p>&copy; 2026 å—é–¢ç«¶é¦¬çµæœé€Ÿå ±</p>
  </footer>
</body>
</html>
